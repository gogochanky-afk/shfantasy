<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SH Fantasy Arena</title>
  <style>
    :root { color-scheme: dark; }
    body { margin:0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial; background:#0b0b0c; color:#eee; }
    .wrap { max-width: 720px; margin: 0 auto; padding: 16px; }
    .nav { display:flex; justify-content:space-between; align-items:center; gap:12px; padding: 10px 0; }
    .brand { font-weight:700; letter-spacing:.2px; }
    .nav-right { display:flex; gap:10px; align-items:center; }
    .pill { border:1px solid #2b2b2e; padding:6px 10px; border-radius:999px; font-size:12px; opacity:.9; }
    .btn { background:#f0a500; border:none; color:#111; padding:10px 12px; border-radius:10px; font-weight:700; cursor:pointer; }
    .btn.secondary { background:transparent; border:1px solid #3a3a3f; color:#eee; }
    .card { background:#141416; border:1px solid #232327; border-radius:14px; padding:16px; margin-top:12px; }
    .row { display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .muted { color:#b7b7bd; font-size:12px; }
    input { width:100%; box-sizing:border-box; padding:12px; border-radius:10px; border:1px solid #2b2b2e; background:#0f0f10; color:#eee; margin-top:10px; }
    .toast { position: fixed; left: 50%; bottom: 18px; transform: translateX(-50%); background:#17171a; border:1px solid #2b2b2e; padding:10px 12px; border-radius:12px; font-size:13px; display:none; }
    a { color: inherit; text-decoration: none; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="nav">
      <div class="brand">ðŸ”¥ SH Fantasy Arena</div>
      <div class="nav-right">
        <div class="pill" id="modePill">Mode: DEMO</div>
        <div class="pill" id="userPill">User: -</div>
        <button class="btn secondary" id="myEntriesBtn" style="display:none;">ðŸ“’ My Entries</button>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <div style="font-size:14px; font-weight:700;">Start</div>
          <div class="muted">Enter your username once. We save it on this device.</div>
        </div>
      </div>
      <input id="usernameInput" placeholder="Your username (e.g. Hugo)" maxlength="32" />
      <div style="display:flex; gap:10px; margin-top:10px;">
        <button class="btn" id="saveUserBtn">Save Username</button>
        <button class="btn secondary" id="clearUserBtn">Clear</button>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <div style="font-size:14px; font-weight:700;">Today Arena</div>
          <div class="muted">Salary Cap: <span id="capText">10</span> Â· Roster Size: <span id="rosterText">5</span></div>
        </div>
        <button class="btn" id="joinBtn">Join</button>
      </div>
      <div class="muted" style="margin-top:8px;">Join will take you directly to Draft.</div>
    </div>

    <div class="toast" id="toast"></div>
  </div>

  <script>
    const LS_USER = "shf_username";

    function toast(msg) {
      const el = document.getElementById("toast");
      el.textContent = msg;
      el.style.display = "block";
      setTimeout(() => (el.style.display = "none"), 1500);
    }

    function getUsername() {
      return (localStorage.getItem(LS_USER) || "").trim();
    }

    function setUsername(name) {
      localStorage.setItem(LS_USER, (name || "").trim().slice(0, 32));
      renderUser();
    }

    function clearUsername() {
      localStorage.removeItem(LS_USER);
      renderUser();
    }

    function renderUser() {
      const u = getUsername();
      document.getElementById("userPill").textContent = "User: " + (u || "-");
      document.getElementById("usernameInput").value = u || "";
      document.getElementById("myEntriesBtn").style.display = u ? "inline-block" : "none";
    }

    async function loadPools() {
      const r = await fetch("/api/pools");
      const j = await r.json();
      // keep demo constants
      document.getElementById("modePill").textContent = "Mode: " + (j.mode || "DEMO");
      const today = (j.pools || []).find(p => p.id === "demo-today") || { salaryCap: 10, rosterSize: 5 };
      document.getElementById("capText").textContent = today.salaryCap;
      document.getElementById("rosterText").textContent = today.rosterSize;
    }

    async function joinToday() {
      const username = getUsername();
      if (!username) {
        toast("Please save username first.");
        return;
      }
      const payload = { poolId: "demo-today", username };
      const r = await fetch("/api/join", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });
      const j = await r.json();
      if (!j.ok) {
        toast(j.error || "Join failed");
        return;
      }
      // Professional flow: go Draft immediately
      window.location.href = "/draft.html?entryId=" + encodeURIComponent(j.entryId);
    }

    document.getElementById("saveUserBtn").addEventListener("click", () => {
      const v = document.getElementById("usernameInput").value.trim();
      if (!v) return toast("Username required.");
      setUsername(v);
      toast("Saved.");
    });

    document.getElementById("clearUserBtn").addEventListener("click", () => {
      clearUsername();
      toast("Cleared.");
    });

    document.getElementById("myEntriesBtn").addEventListener("click", () => {
      window.location.href = "/my-entries.html";
    });

    document.getElementById("joinBtn").addEventListener("click", joinToday);

    // init
    renderUser();
    loadPools().catch(() => {});
  </script>
</body>
</html>
