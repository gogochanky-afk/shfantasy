<!-- /public/my-entries.html -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>My Entries</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #111;
        color: #fff;
        padding: 20px;
      }
      a { color: #f90; text-decoration: none; }
      .topbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 14px;
      }
      .pill {
        display: inline-block;
        background: #222;
        border-radius: 999px;
        padding: 8px 12px;
        font-size: 14px;
      }
      .card {
        background: #222;
        border-radius: 12px;
        padding: 14px;
        margin: 12px 0;
      }
      .row {
        display: flex;
        gap: 10px;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
      }
      input {
        background: #111;
        border: 1px solid #444;
        color: #fff;
        border-radius: 8px;
        padding: 8px 10px;
        min-width: 180px;
      }
      button {
        background: orange;
        border: none;
        border-radius: 8px;
        padding: 8px 12px;
        cursor: pointer;
        font-weight: 700;
      }
      .muted { opacity: 0.75; font-size: 13px; }
      .entry {
        cursor: pointer;
        transition: 0.15s;
      }
      .entry:hover { transform: translateY(-1px); background: #262626; }
      .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    </style>
  </head>
  <body>
    <div class="topbar">
      <div class="pill">ğŸ“Œ <b>My Entries</b></div>
      <div><a href="/">â† Back</a></div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <div class="muted">Current User</div>
          <div style="font-size: 20px; font-weight: 800" id="currentUser">-</div>
        </div>

        <div style="display:flex; gap:8px; align-items:center;">
          <input id="userInput" placeholder="Switch user (e.g. Hugo)" />
          <button id="saveUserBtn">Save</button>
        </div>
      </div>
      <div class="muted" style="margin-top:10px;">
        æç¤ºï¼šJoin ä¹‹å¾Œæœƒè‡ªå‹•è¨˜ä½ä½ å€‹åï¼ˆlocalStorageï¼‰ã€‚ä½ äº¦å¯ä»¥å–ºåº¦åˆ‡æ› userã€‚
      </div>
    </div>

    <div class="muted" id="summary">Loading...</div>
    <div id="list"></div>

    <script>
      function getStoredUser() {
        return (
          localStorage.getItem("sh_username") ||
          localStorage.getItem("username") ||
          localStorage.getItem("sh_user") ||
          localStorage.getItem("user") ||
          ""
        ).trim();
      }

      function setStoredUser(u) {
        localStorage.setItem("sh_username", u);
        localStorage.setItem("username", u); // fallback (å…¼å®¹èˆŠkey)
      }

      async function loadEntries(username) {
        const summary = document.getElementById("summary");
        const list = document.getElementById("list");
        list.innerHTML = "";
        summary.textContent = "Loading...";

        if (!username) {
          summary.textContent = "â— Please set a username first.";
          return;
        }

        const res = await fetch(`/api/my-entries?username=${encodeURIComponent(username)}`);
        const data = await res.json();

        if (!data || !data.ok) {
          summary.textContent = "âŒ Failed to load entries.";
          return;
        }

        document.getElementById("currentUser").textContent = data.username || username;

        summary.textContent = `Mode: ${data.mode || "-"} â€¢ Total: ${(data.entries || []).length}`;

        const entries = data.entries || [];
        if (!entries.length) {
          list.innerHTML = `<div class="card">No entries yet. Go back and Join a pool.</div>`;
          return;
        }

        entries.forEach((e) => {
          const div = document.createElement("div");
          div.className = "card entry";
          div.innerHTML = `
            <div class="row">
              <div>
                <div><b>Entry #${e.id}</b></div>
                <div class="muted">Pool: <span class="mono">${e.poolId}</span></div>
                <div class="muted">Created: <span class="mono">${e.createdAt || "-"}</span></div>
              </div>
              <div class="pill">Open Draft â†’</div>
            </div>
          `;

          div.addEventListener("click", () => {
            // å¸¶ entryId + poolId å» draft
            window.location.href = `/draft.html?entryId=${encodeURIComponent(e.id)}&poolId=${encodeURIComponent(e.poolId)}`;
          });

          list.appendChild(div);
        });
      }

      // init
      const stored = getStoredUser();
      document.getElementById("currentUser").textContent = stored || "-";
      document.getElementById("userInput").value = stored || "";

      document.getElementById("saveUserBtn").addEventListener("click", () => {
        const u = document.getElementById("userInput").value.trim();
        if (!u) return alert("Please enter a username");
        setStoredUser(u);
        loadEntries(u);
      });

      loadEntries(stored);
    </script>
  </body>
</html>
