<!-- /public/my-entries.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Entries ¬∑ SH Fantasy</title>
  <style>
    :root { color-scheme: dark; }
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;background:#0b0c0f;color:#eaeaea;}
    .wrap{max-width:720px;margin:0 auto;padding:18px;}
    .nav{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;gap:12px;}
    .brand{font-weight:800;font-size:20px;}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
    .pill{border:1px solid #2b2b2e;border-radius:999px;padding:8px 10px;font-size:12px;color:#cfcfcf;background:#101114;}
    .btn{background:#f0a500;border:none;border-radius:10px;padding:10px 14px;font-weight:800;color:#111;cursor:pointer;}
    .btn.secondary{background:transparent;border:1px solid #2b2b2e;color:#eaeaea;}
    .card{background:#141416;border:1px solid #242427;border-radius:16px;padding:14px;margin-top:12px;}
    .title{font-weight:800;font-size:18px;margin:0 0 6px;}
    .muted{color:#b7b7bd;font-size:12px;}
    a{color:#f0a500;text-decoration:none;}
    .item{border:1px solid #242427;border-radius:14px;background:#101114;padding:12px;margin-bottom:10px;}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:#1b1c20;border:1px solid #303036;color:#fff;padding:10px 12px;border-radius:12px;font-size:13px;opacity:0;pointer-events:none;transition:opacity .15s;}
    .toast.show{opacity:1;}
    code{font-size:12px;color:#d5d5d5;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="nav">
      <div class="brand">üìí My Entries</div>
      <div class="row">
        <a class="pill" href="/">‚Üê Home</a>
        <div class="pill" id="userPill">User: ‚Äî</div>
      </div>
    </div>

    <div class="card">
      <div class="title">Entries</div>
      <div class="muted" id="hint">Loading‚Ä¶</div>
      <div style="height:10px"></div>
      <div id="list"></div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);
  const toastEl = $('toast');
  let toastTimer = null;

  function toast(msg){
    toastEl.textContent = msg;
    toastEl.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=>toastEl.classList.remove('show'), 1800);
  }

  function getUsername(){
    return (localStorage.getItem('shf_username') || '').trim();
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

  async function load(){
    const u = getUsername();
    $('userPill').textContent = 'User: ' + (u || '‚Äî');
    if(!u){
      $('hint').textContent = 'No username saved. Go back Home and Save Username.';
      return;
    }

    try{
      const r = await fetch('/api/my-entries?username=' + encodeURIComponent(u), { cache:'no-store' });
      const j = await r.json();
      if(!j.ok) throw new Error(j.message || j.error || 'failed');

      const entries = j.entries || [];
      const pools = j.pools || [];
      const poolName = (id)=>{
        const p = pools.find(x=>x.id===id);
        return p ? p.name : id;
      };

      if(!entries.length){
        $('hint').textContent = 'No entries yet.';
        $('list').innerHTML = '';
        return;
      }

      $('hint').textContent = 'Tap an entry to open Draft.';
      const list = $('list');
      list.innerHTML = '';
      for(const e of entries){
        const div = document.createElement('div');
        div.className = 'item';
        const picked = (e.players || []).length;
        div.innerHTML = `
          <div style="display:flex;justify-content:space-between;gap:10px;align-items:flex-start;">
            <div>
              <div style="font-weight:900;">${escapeHtml(poolName(e.poolId))}</div>
              <div class="muted">Picked: ${picked} ¬∑ Updated: ${escapeHtml(e.updatedAt || '')}</div>
              <div class="muted"><code>${escapeHtml(e.id)}</code></div>
            </div>
            <a class="pill" href="/draft.html?entryId=${encodeURIComponent(e.id)}">Open</a>
          </div>
        `;
        list.appendChild(div);
      }

    }catch(e){
      $('hint').textContent = 'Load failed.';
      toast('Load failed: ' + (e.message || 'error'));
    }
  }

  load();
})();
</script>
</body>
</html>
